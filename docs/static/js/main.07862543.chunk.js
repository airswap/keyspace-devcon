(window["webpackJsonpkeyspace-test"]=window["webpackJsonpkeyspace-test"]||[]).push([[0],{1063:function(e,t){},1065:function(e,t){},1072:function(e,t){},1074:function(e,t){},1082:function(e,t){},1086:function(e,t){},1088:function(e,t){},1095:function(e,t){},1097:function(e,t){},1156:function(e,t){},1182:function(e,t){},1188:function(e,t){},1190:function(e,t){},1350:function(e,t){},1381:function(e,t){},1383:function(e,t){},1401:function(e,t){},1403:function(e,t){},1428:function(e,t){},1430:function(e,t){},1470:function(e,t){},1484:function(e,t){},1489:function(e,t){},1491:function(e,t){},1497:function(e,t){},1499:function(e,t){},1527:function(e,t,n){"use strict";n.r(t);var r=n(73),a=n(77),s=n(105),i=n(87),c=n(104),o=n(0),u=n.n(o),d=n(106),p=n.n(d),l=n(1538),f=n(3),h=n.n(f),g=n(27),m=n(28),y=n(65),b=n(2),v=n(80),S=n.n(v),w=n(163),P=n.n(w),k=n(354),x=n.n(k),O=n(650),j=n.n(O),E=n(56),G=n(192),K=n(706),A=K.ipfsStoreJSON,M=K.ipfsFetchJSONFromCID,C=function(e){return"IPFS location of my Keyspace identity: ".concat(e)},I=P.a.struct({public:P.a.String,private:P.a.String}),L=P.a.refinement(P.a.String,(function(e){return e.length>30}),"ipfsHash");function F(e,t){return R.apply(this,arguments)}function R(){return(R=Object(g.a)(h.a.mark((function e(t,n){var r,a,s,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getAddress();case 2:return r=e.sent,e.next=5,E.generateKey({userIds:[{address:r}],curve:"p256",passphrase:t});case 5:return a=e.sent,s=a.privateKeyArmored,i=a.publicKeyArmored,e.abrupt("return",I({private:s,public:i}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){var t=e.address,n=e.signature,r=e.ipfsKeyHash,a=e.message;return new Promise((function(e,s){return Promise.all([x()("".concat(G.SLS_PGP_URL,"/storeHash"),{method:"post",mode:"cors",body:JSON.stringify({address:t,signature:n,ipfsHash:r,message:a})})]).then((function(e){var t=Object(m.a)(e,1)[0];return t.ok||s(t.statusText),t.text()})).then((function(t){return e(t)})).catch((function(e){s(e)}))}))}var z=function(){function e(t){var n=t.signer,a=t.signedSeed,s=t.seed,i=t.onRequestSignedSeed,c=t.onGeneratedSignedSeed,o=t.onRequestPGPKeyPair,u=t.onGeneratedPGPKeyPair;if(Object(r.a)(this,e),!n)throw new Error("This keyspace implementation requires a valid ethers.js Signer");this.onRequestSignedSeed=i.bind(this),this.onGeneratedSignedSeed=c.bind(this),this.onRequestPGPKeyPair=o.bind(this),this.onGeneratedPGPKeyPair=u.bind(this),this.seed=s,this.signedSeed=a,this.signer=n,this.ipfsHashes={},this.pgpKeys={},this.initialized=this.init()}return Object(a.a)(e,[{key:"init",value:function(){var e=Object(g.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signer.getAddress();case 2:return this.signerAddress=e.sent.toLowerCase(),this.seed=this.seed||(t=this.signerAddress,"I'm generating my encryption keys for AirSwap ".concat(t)),e.prev=4,e.next=7,this.getHashByAddress(this.signerAddress);case 7:return this.signerIPFSHash=e.sent,e.next=10,M(this.signerIPFSHash);case 10:this.signerPGPKey=e.sent,e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(4),console.log("ipfsHash for wallet not found"),e.abrupt("return",!0);case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}var t}),e,this,[[4,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"createSignedSeed",value:function(){var e=Object(g.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.signer.signMessage(this.seed));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHashByAddress",value:function(){var e=Object(g.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.abrupt("return",x()("".concat(G.SLS_PGP_URL,"/getHashByAddress?").concat(j.a.stringify({address:t.toLowerCase(),network:4})),{method:"get",mode:"cors"}).then(function(){var e=Object(g.a)(h.a.mark((function e(r){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.ok){e.next=2;break}throw new Error(r.statusText);case 2:return e.t0=L,e.next=5,r.text();case 5:return e.t1=e.sent,a=(0,e.t0)(e.t1),n.ipfsHashes[t.toLowerCase()]=a,e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchKeyByAddress",value:function(){var e=Object(g.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pgpKeys[t.toLowerCase()]){e.next=2;break}return e.abrupt("return",this.pgpKeys[t.toLowerCase()]);case 2:return e.next=4,this.getHashByAddress(t.toLowerCase());case 4:return n=e.sent,e.next=7,M(n);case 7:return r=e.sent,this.pgpKeys[t.toLowerCase()]=r,e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setUpPGP",value:function(){var e=Object(g.a)(h.a.mark((function e(){var t,n,r,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initialized;case 2:if(!this.isPGPReady()){e.next=6;break}return this.onGeneratedSignedSeed(this.signedSeed),this.onGeneratedPGPKeyPair(this.signerPGPKey),e.abrupt("return",!0);case 6:if(this.signedSeed){e.next=20;break}return this.onRequestSignedSeed(this.seed),e.prev=8,e.next=11,this.createSignedSeed();case 11:this.signedSeed=e.sent,this.onGeneratedSignedSeed(this.signedSeed),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(8),e.abrupt("return",Promise.reject(e.t0));case 18:e.next=21;break;case 20:this.onGeneratedSignedSeed(this.signedSeed);case 21:if(this.signerPGPKey){e.next=66;break}return this.onRequestPGPKeyPair(this.signerAddress),e.prev=23,e.next=26,F(this.signedSeed,this.signer);case 26:t=e.sent,e.next=32;break;case 29:return e.prev=29,e.t1=e.catch(23),e.abrupt("return",Promise.reject(e.t1));case 32:return e.prev=32,e.t2=L,e.next=36,A(t);case 36:e.t3=e.sent,n=(0,e.t2)(e.t3),e.next=43;break;case 40:return e.prev=40,e.t4=e.catch(32),e.abrupt("return",Promise.reject("Could not connect to IPFS"));case 43:return r=C(n),e.prev=44,e.next=47,this.signer.signMessage(r);case 47:a=e.sent,e.next=53;break;case 50:return e.prev=50,e.t5=e.catch(44),e.abrupt("return",Promise.reject(e.t5));case 53:return e.prev=53,e.next=56,N({signature:a,message:r,ipfsKeyHash:n,address:this.signerAddress});case 56:this.onGeneratedPGPKeyPair(t),e.next=62;break;case 59:return e.prev=59,e.t6=e.catch(53),e.abrupt("return",Promise.reject(e.t6));case 62:this.signerPGPKey=t,this.signerIPFSHash=n,e.next=67;break;case 66:this.onGeneratedPGPKeyPair(this.signerPGPKey);case 67:return e.prev=67,e.next=70,this.fetchKeyByAddress(this.signerAddress);case 70:e.next=75;break;case 72:return e.prev=72,e.t7=e.catch(67),e.abrupt("return",Promise.reject(e.t7));case 75:return e.abrupt("return",this.isPGPReady());case 76:case"end":return e.stop()}}),e,this,[[8,15],[23,29],[32,40],[44,50],[53,59],[67,72]])})));return function(){return e.apply(this,arguments)}}()},{key:"encrypt",value:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var r,a,s,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchKeyByAddress(n.toLowerCase());case 2:return r=e.sent,a=r.public,e.t0=m.a,e.next=7,E.key.readArmored(this.signerPGPKey.private);case 7:return e.t1=e.sent.keys,s=(0,e.t0)(e.t1,1),i=s[0],e.next=12,i.decrypt(this.signedSeed);case 12:return e.abrupt("return",new Promise(function(){var e=Object(g.a)(h.a.mark((function e(n,r){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=E,e.t1=E.message.fromText(t),e.next=4,E.key.readArmored(a);case 4:e.t2=e.sent.keys,e.t3=[i],e.t4={message:e.t1,publicKeys:e.t2,privateKeys:e.t3},e.t5=function(e){n(e.data)},e.t6=r,e.t0.encrypt.call(e.t0,e.t4).then(e.t5).catch(e.t6);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var r,a,s,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchKeyByAddress(n.toLowerCase());case 2:return r=e.sent,a=r.public,e.t0=m.a,e.next=7,E.key.readArmored(this.signerPGPKey.private);case 7:return e.t1=e.sent.keys,s=(0,e.t0)(e.t1,1),i=s[0],e.next=12,i.decrypt(this.signedSeed);case 12:return e.abrupt("return",new Promise(function(){var e=Object(g.a)(h.a.mark((function e(n,r){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=E,e.next=3,E.message.readArmored(t);case 3:return e.t1=e.sent,e.next=6,E.key.readArmored(a);case 6:e.t2=e.sent.keys,e.t3=[i],e.t4={message:e.t1,publicKeys:e.t2,privateKeys:e.t3},e.t5=function(e){n(e.data)},e.t6=r,e.t0.decrypt.call(e.t0,e.t4).then(e.t5).catch(e.t6);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=Object(g.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setUpPGP();case 2:return e.next=4,E.key.readArmored(this.signerPGPKey.private);case 4:return n=e.sent.keys[0],e.next=7,n.decrypt(this.signedSeed);case 7:return e.next=9,E.sign({message:E.cleartext.fromText(t),privateKeys:[n]}).then((function(e){return e.data}));case 9:return r=e.sent,e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"validate",value:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var r,a,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchKeyByAddress(n.toLowerCase());case 2:return r=e.sent,a=r.public,e.t0=E,e.next=7,E.cleartext.readArmored(t);case 7:return e.t1=e.sent,e.next=10,E.key.readArmored(a);case 10:return e.t2=e.sent.keys,e.t3={message:e.t1,publicKeys:e.t2},e.next=14,e.t0.verify.call(e.t0,e.t3);case 14:return s=e.sent,e.abrupt("return",S.a.get(s,"signatures.0.valid"));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"isPGPReady",value:function(){return this.signedSeed&&this.signerIPFSHash&&this.signerPGPKey}}]),e}(),J=n(651),H=n(1543),q=n(1536),U=n(1539),B=n(1528),T=n(1546),_=n(194),D=n(1545);function W(){var e=Object(y.a)(["\n  //background: #2b71ff;\n  display: inline-block;\n  //color: white;\n  padding: 10px;\n  border-radius: 40px;\n  width: auto;\n  text-align: center;\n  width: 300px;\n"]);return W=function(){return e},e}var V=Object(b.default)(D.a)(W()),X=n(165),Q=n(362),Y=n(1544),Z=n(1542),$=n(1541),ee=n(1540),te=n(1537),ne=n(363),re=n.n(ne),ae="QmXG8yk8UJjMT6qtE2zSxzz3U7z5jSYRgVWLCUFqAVnByM",se=function(){function e(t,n){Object(r.a)(this,e),this.node=new re.a({repo:"./ipfs",EXPERIMENTAL:{pubsub:!0},relay:{enabled:!0,hop:{enabled:!0,active:!0}},config:{Addresses:{Swarm:["/dns4/ws-star.discovery.libp2p.io/tcp/443/wss/p2p-websocket-star"]}}}),this.node.on("ready",this._init.bind(this)),this.onNewMessage=n,this.onReady=t}return Object(a.a)(e,[{key:"_init",value:function(){var e=Object(g.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.node.pubsub.subscribe(ae,this.handleMessageReceived.bind(this));case 2:this.node.libp2p.on("peer:connect",this.handlePeerConnected.bind(this)),this.onReady();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleMessageReceived",value:function(e){var t=e.data.toString();this.onNewMessage(t),console.log("msg received",t)}},{key:"getIPFSSwarmPeers",value:function(){var e=Object(g.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.node.swarm.peers());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connectToPeer",value:function(){var e=Object(g.a)(h.a.mark((function e(t){var n,r=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:"/p2p-circuit/ipfs/",e.prev=1,e.next=4,this.node.swarm.connect("".concat(n).concat(t));case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handlePeerConnected",value:function(e){e.id.toB58String()}},{key:"sendMessage",value:function(){var e=Object(g.a)(h.a.mark((function e(t){var n,r,a,s=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:ae,e.prev=1,r=JSON.stringify(t),a=re.a.Buffer(r),e.next=6,this.node.pubsub.publish(n,a);case 6:e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(n,!0).forEach((function(t){Object(Q.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oe(){var e=Object(y.a)(["\n margin-bottom: 5px;\n"]);return oe=function(){return e},e}function ue(){var e=Object(y.a)(["\n position: fixed;\n left: 0px;\n bottom: 0px;\n width: 100vw;\n background: white;\n padding: 5px 20px 20px 20px;\n"]);return ue=function(){return e},e}function de(){var e=Object(y.a)(["\n  margin-bottom: 300px;\n"]);return de=function(){return e},e}function pe(){var e=Object(y.a)(["\n  //height: calc(100vh - 182px)\n"]);return pe=function(){return e},e}function le(){var e=Object(y.a)(["\n  height: calc(100vh - 200px);\n  //position: absolute;\n"]);return le=function(){return e},e}function fe(){var e=Object(y.a)(["\n    position: relative;\n    top: -3px;\n"]);return fe=function(){return e},e}function he(){var e=Object(y.a)(["\n  margin: 0 13px;\n"]);return he=function(){return e},e}function ge(){var e=Object(y.a)(["\n  margin-bottom: 10px;\n"]);return ge=function(){return e},e}function me(){var e=Object(y.a)(["\n  border-radius: 15px;\n  padding: 0 15px;\n  overflow: hidden;\n"]);return me=function(){return e},e}var ye=function(e){return{type:"introduction",from:e.from,nickname:e.nickname}},be=function(e){return{type:"requestIntroductions",from:e.from}},ve=function(e){var t=e.message;return{type:"message",from:e.from,to:e.to,message:t}},Se=Object(b.default)(B.a)(me()),we=Object(b.default)(B.a)(ge()),Pe=Object(b.default)(Y.a)(he()),ke=Object(b.default)(T.a)(fe()),xe=function(e){var t=e.from,n=e.to,r=e.message,a=e.nicknames;return u.a.createElement(we,null,u.a.createElement(B.a,{direction:"row"},u.a.createElement(Pe,{size:"xsmall",href:"https://rinkeby.etherscan.io/address/".concat(t),primary:!0,label:a[t]||t}),n?u.a.createElement(u.a.Fragment,null,u.a.createElement(ke,null,"\u2192")," ",u.a.createElement(Pe,{size:"xsmall",href:"https://rinkeby.etherscan.io/address/".concat(n),primary:!0,label:a[n]||n})):null),u.a.createElement(Se,{background:"light-3"},u.a.createElement(H.a,{size:"small"},r)))},Oe=Object(b.default)(B.a)(le()),je=Object(b.default)(B.a)(pe()),Ee=Object(b.default)(B.a)(de()),Ge=Object(b.default)(B.a)(ue()),Ke=Object(b.default)(Z.a)(oe()),Ae=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(c)))).state={peers:[],selectedPeers:[],messages:[],myMessages:[],newMessage:"",nicknames:{}},n}return Object(c.a)(t,e),Object(a.a)(t,[{key:"componentWillUnmount",value:function(){}},{key:"componentDidMount",value:function(){var e=this,t=this.props.address;this.broadcaster=new se((function(){e.broadcaster.sendMessage(be({from:t})),window.setTimeout((function(){return e.broadcaster.sendMessage(be({from:t}))}),5e3),window.setTimeout((function(){return e.broadcaster.sendMessage(be({from:t}))}),1e4),window.setTimeout((function(){return e.broadcaster.sendMessage(be({from:t}))}),15e3),window.setInterval((function(){return e.broadcaster.sendMessage(be({from:t}))}),6e4)}),(function(n){var r=JSON.parse(n);if("requestIntroductions"!==r.type){if("introduction"===r.type)return e.addIntroduction(r.from),void(r.nickname&&e.setState({nicknames:ce(Object(Q.a)({},r.from,r.nickname),e.state.nicknames)}));"message"===r.type&&r.to===t&&e.decryptMessage(r),e.setState({messages:[].concat(Object(X.a)(e.state.messages),[r])})}else e.broadcaster.sendMessage(ye({from:t,nickname:e.state.nicknames[t]}))}))}},{key:"addIntroduction",value:function(e){var t=this.state,n=t.peers,r=t.selectedPeers;S.a.includes(n,e.toLowerCase())||this.setState({selectedPeers:[].concat(Object(X.a)(r),[e.toLowerCase()])});var a=S.a.uniq([].concat(Object(X.a)(n),[e.toLowerCase()]));this.setState({peers:a})}},{key:"decryptMessage",value:function(){var e=Object(g.a)(h.a.mark((function e(t){var n,r,a,s,i,c,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.from,r=t.message,a=this.props.keySpace,s=this.state.myMessages,e.next=5,a.decrypt(r,n.toLowerCase());case 5:i=e.sent,c={from:n,message:i},o=[].concat(Object(X.a)(s),[c]),this.setState({myMessages:o});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=this,t=this.state,n=t.selectedPeers,r=t.newMessage,a=this.props,s=a.keySpace,i=a.address;n.map(function(){var t=Object(g.a)(h.a.mark((function t(n){var a;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.encrypt(r,n.toLowerCase());case 2:a=t.sent,e.broadcaster.sendMessage(ve({from:i,to:n.toLowerCase(),message:a}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.setState({newMessage:""})}},{key:"togglePeerInclusion",value:function(e){var t=this.state.selectedPeers;S.a.includes(t,e)?this.setState({selectedPeers:S.a.without(t,e)}):this.setState({selectedPeers:[].concat(Object(X.a)(t),[e])})}},{key:"renderMessages",value:function(){var e=this.state,t=e.messages,n=e.myMessages,r=e.nicknames;return u.a.createElement(Ee,{fill:"horizontal",flex:{grow:1}},u.a.createElement($.a,null,u.a.createElement(ee.a,{title:"My Decrypted Chat"},u.a.createElement(je,{pad:"medium",overflow:"scroll"},n.map((function(e){var t=e.from,n=e.message;return u.a.createElement(xe,Object.assign({from:t,message:n},{nicknames:r}))})))),u.a.createElement(ee.a,{title:"Encrypted PubSub Stream"},u.a.createElement(je,{pad:"medium",overflow:"scroll"},t.map((function(e){var t=e.from,n=e.to,a=e.message;return u.a.createElement(xe,Object.assign({from:t,to:n,message:a},{nicknames:r}))}))))))}},{key:"setNickname",value:function(){var e=window.prompt("Please enter your nickname"),t=this.props.address;this.broadcaster.sendMessage(ye({from:t,nickname:e}))}},{key:"renderPeers",value:function(){var e=this,t=this.props.address,n=this.state,r=n.peers,a=n.selectedPeers,s=n.nicknames,i="Known Peers (".concat(r.length,") Selected Peers (").concat(a.length,")");return u.a.createElement(q.a,null,u.a.createElement(U.a,{label:i},u.a.createElement(B.a,{pad:"small",background:"light-2",overflow:"scroll"},r.map((function(n){var r=s[n]||n;return u.a.createElement(Ke,{checked:S.a.includes(a,n),label:n===t?u.a.createElement(T.a,null,r," ",u.a.createElement(Y.a,{label:"Set Nickname",onClick:function(){return e.setNickname()}})):u.a.createElement(T.a,null," ",r," "),disabled:n===t,onChange:function(){return e.togglePeerInclusion(n)}})})))))}},{key:"render",value:function(){var e=this,t=this.state,n=t.newMessage;t.peers;return u.a.createElement(Oe,null,this.renderMessages(),u.a.createElement(Ge,null,this.renderPeers(),u.a.createElement(te.a,{placeholder:"Send a message to the workshop's IPFS PubSub topic",value:n,onChange:function(t){return e.setState({newMessage:t.target.value})}}),u.a.createElement("br",null),u.a.createElement(V,{label:"Send Message",onClick:function(){e.sendMessage()}})))}}]),t}(u.a.Component);function Me(){var e=Object(y.a)(["\n  min-height: 100vh;\n"]);return Me=function(){return e},e}var Ce,Ie,Le=function(){return u.a.createElement(H.a,null,"Initialize Keyspace to use IPFS pubsub chat")},Fe=function(e){var t=e.content,n=e.label;return u.a.createElement(q.a,null,u.a.createElement(U.a,{label:n},u.a.createElement(B.a,{pad:"small",background:"light-2",overflow:"scroll"},u.a.createElement(T.a,{size:"xsmall"},t))))},Re=Object(b.default)(B.a)(Me()),Ne=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(c)))).state={stage:"initial",unsignedSeed:"I'm generating my KeySpace PGP key encryption password"},n}return Object(c.a)(t,e),Object(a.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.web3.eth.getAccounts((function(t,n){var r=Object(m.a)(n,1)[0];r&&Object(_.getSignedSeedForAddress)(r.toLowerCase())&&e.init()}))}},{key:"init",value:function(){var e=Object(g.a)(h.a.mark((function e(){var t,n,r=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.ethereum.enable();case 2:return this.setState({stage:"web3Enabled"}),Ce=new J.ethers.providers.Web3Provider(window.ethereum).getSigner(),e.next=6,Ce.getAddress();case 6:return t=e.sent.toLowerCase(),this.setState({walletAddress:t}),n=Object(_.getSignedSeedForAddress)(t),Ie=new z({signer:Ce,signedSeed:n,seed:this.state.unsignedSeed,onRequestSignedSeed:function(e){r.setState({unsignedSeed:e,stage:"waitingForSeedSignature"})},onGeneratedSignedSeed:function(e){Object(_.storeSignedSeedForAddress)({signedSeed:e,address:t}),r.setState({signedSeed:e,stage:"seedSigned"})},onRequestPGPKeyPair:function(e){r.setState({stage:"waitingPGPPairSignature"})},onGeneratedPGPKeyPair:function(e){r.setState({stage:"pgpPairGenerated",pgpKey:e})}}),e.prev=10,e.next=13,Ie.setUpPGP();case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(10),this.setState({stage:"keyspaceInitializationError",initializationError:e.t0}),e.abrupt("return");case 19:case"end":return e.stop()}}),e,this,[[10,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"renderUnsignedSeed",value:function(){var e=this.state.unsignedSeed;return e?u.a.createElement(Fe,{label:"Unsigned Seed",content:e}):null}},{key:"renderSignedSeed",value:function(){var e=this.state.signedSeed;return e?u.a.createElement(Fe,{label:"Signed Seed (PGP key encryption password)",content:e}):null}},{key:"renderPGPKey",value:function(){var e=this.state.pgpKey;return e?u.a.createElement(u.a.Fragment,null,u.a.createElement(Fe,{label:"PGP Public Key",content:e.public.split("\\r\\n").map((function(e,t){return u.a.createElement("span",{key:t},e,u.a.createElement("br",null))}))}),u.a.createElement(Fe,{label:"PGP Private Key",content:e.private.split("\\r\\n").map((function(e,t){return u.a.createElement("span",{key:t},e,u.a.createElement("br",null))}))})):null}},{key:"render",value:function(){var e,t=this,n=this.state,r=n.stage,a=n.initializationError,s=n.walletAddress;return"initial"===r&&(e=u.a.createElement(V,{onClick:function(){return t.init()}},"Connect To Metamask")),"web3Enabled"===r&&(e=u.a.createElement(H.a,null,"Initializing KeySpace")),"waitingForSeedSignature"===r&&(e=u.a.createElement(H.a,null,"Initializing KeySpace, Sign to create your seed")),"waitingPGPPairSignature"===r&&(e=u.a.createElement(H.a,null,"Sign your generated PGP key pair to authenticate it")),"pgpPairGenerated"===r&&(e=u.a.createElement(H.a,null,"KeySpace is ready")),"keyspaceInitializationError"===r&&(e=u.a.createElement(u.a.Fragment,null,u.a.createElement(H.a,null,"Keyspace Initialization Error: ".concat(Object(_.formatErrorMessage)(a))),u.a.createElement(V,{onClick:function(){return t.init()}},"Retry"))),u.a.createElement(Re,{direction:"row",fill:"horizontal",pad:"medium"},u.a.createElement(B.a,{width:"70%"},"pgpPairGenerated"===r?u.a.createElement(Ae,{address:s,keySpace:Ie}):u.a.createElement(Le,null)),u.a.createElement(B.a,{width:"30%"},e,this.renderUnsignedSeed(),this.renderSignedSeed(),this.renderPGPKey()))}}]),t}(u.a.Component),ze={global:{font:{family:"Lato"}}},Je=function(e){function t(){return Object(r.a)(this,t),Object(s.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){return u.a.createElement(l.a,{full:!0,theme:ze},u.a.createElement(Ne,null))}}]),t}(u.a.Component),He=document.getElementById("root");p.a.render(u.a.createElement(Je,null),He)},192:function(e,t){e.exports={SLS_PGP_URL:"https://pgp.development.airswap.io"}},194:function(e,t,n){var r=n(80);e.exports={formatErrorMessage:function(e){return r.isObject(e)&&e.message?e.message.split("\n")[0]:r.isString(e)?e:""},storeSignedSeedForAddress:function(e){var t=e.address,n=e.signedSeed,r=JSON.stringify({address:t,signedSeed:n});localStorage.setItem("signedSeed",r)},getSignedSeedForAddress:function(e){var t=localStorage.getItem("signedSeed");if(t){var n=JSON.parse(t);if(n.address===e)return n.signedSeed}}}},276:function(e,t){},492:function(e,t){},671:function(e,t,n){e.exports=n(1527)},706:function(e,t,n){"use strict";n.r(t),n.d(t,"ipfsStoreJSON",(function(){return m})),n.d(t,"ipfsFetchJSONFromCID",(function(){return v}));var r=n(3),a=n.n(r),s=n(27),i=n(80),c=n.n(i),o=n(355),u=n.n(o),d=n(356),p=n.n(d),l=n(192),f=new p.a({host:"ipfs.infura.io",port:5001,protocol:"https"}),h=new p.a({host:"ipfs.airswap.io",port:443,protocol:"https"}),g=function(e){var t="".concat(l.SLS_PGP_URL,"/storePinata");return u.a.post(t,e).then((function(e){return e.data.IpfsHash}))};function m(e){return y.apply(this,arguments)}function y(){return(y=Object(s.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.a.isString(t)?JSON.stringify(JSON.parse(t)):JSON.stringify(t),e.abrupt("return",new Promise((function(e,t){var r=0;h.add(n).then(e).catch((function(e){2===++r&&t(e)})),f.add(n).then(e).catch((function(e){2===++r&&t(e)})),g(JSON.parse(n))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=function(e){return u.a.get("https://cloudflare-ipfs.com/ipfs/".concat(e)).then((function(e){return JSON.stringify(e.data)}))};function v(e){return S.apply(this,arguments)}function S(){return(S=Object(s.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){if(t){var r=0;h.cat(t).then(e).catch((function(e){3===++r&&n(e)})),f.cat(t).then(e).catch((function(e){3===++r&&n(e)})),b(t).then(e).catch((function(e){3===++r&&n(e)}))}else e(void 0)}));case 2:return n=e.sent,e.abrupt("return",JSON.parse(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},832:function(e,t){},843:function(e,t){},857:function(e,t){},859:function(e,t){},953:function(e,t){},955:function(e,t){}},[[671,1,2]]]);
//# sourceMappingURL=main.07862543.chunk.js.map